# ユーザー通知システム 概要

> このドキュメントはPM・ステークホルダー向けです。
> 生成元: `specs/user-notification/spec.md`

## 目的

ユーザーに重要なイベント、更新情報、必要なアクションについてタイムリーに通知するためのシステムです。複数のチャネル（メール、プッシュ通知、アプリ内通知）を通じて配信します。

## 対象ユーザー

- エンドユーザー（通知を受け取る側）
- 管理者（通知を送信・管理する側）
- カスタマーサポート（通知状況を確認する側）

## スコープ

### 含まれる機能

- メール通知の送信
- モバイルプッシュ通知の送信
- アプリ内通知の送信
- 通知設定の管理（ユーザーごと）
- 既読/未読ステータスの追跡

### 含まれない機能

- SMS通知
- サードパーティ連携（Slack、Teamsなど）
- スケジュール通知（v2で対応予定）

## ユーザーストーリー

### 通知を受け取る

ユーザーとして、重要なイベントが発生したときに通知を受け取りたい。
通知はメール、プッシュ、アプリ内から選択できる。

**利用シーン例:**
1. 注文が発送されたときにプッシュ通知を受け取る
2. パスワードリセットのリンクをメールで受け取る
3. 新機能のお知らせをアプリ内で確認する

### 通知を管理する

ユーザーとして、受け取った通知を一覧で確認し、既読にしたい。

**利用シーン例:**
1. アプリを開いて未読通知を確認
2. 通知をタップして詳細を確認
3. 通知を既読にする

## 受け入れ条件

### AC1: メール通知送信

| 条件 | 内容 |
|------|------|
| 前提 | 有効な通知リクエスト（type=email） |
| 操作 | 通知送信APIを呼び出す |
| 結果 | 通知がキューに入り、30秒以内にメール送信 |

### AC2: 未読通知取得

| 条件 | 内容 |
|------|------|
| 前提 | ユーザーに5件の未読通知がある |
| 操作 | 未読通知一覧APIを呼び出す |
| 結果 | read=falseの5件の通知が返却される |

### AC3: 既読マーク

| 条件 | 内容 |
|------|------|
| 前提 | 未読の通知が存在する |
| 操作 | 既読マークAPIを呼び出す |
| 結果 | 通知が既読になり、タイムスタンプが記録される |

## 成功指標

- 通知配信成功率: 99.5%以上
- メール到達率: 95%以上
- プッシュ通知開封率: 30%以上
- 未読通知の平均滞留時間: 24時間以内

## リスクと制約

### リスク

- メールがスパムフィルターに引っかかる可能性
- プッシュ通知の許可をユーザーが拒否する可能性
- 大量通知による配信遅延

### 制約

- 同時接続ユーザー数: 10,000
- メール配信: 30秒以内
- プッシュ通知: 5秒以内
- SMS、外部連携は本スコープ外
